<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Spotify Summary</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <header>
        <h1>Your Spotify Summary</h1>
    </header>
    
    <main>
        <section class="top-artists">
            <h2>Your Top Artists (Past 6 Months)</h2>
            <div class="artist-cards">
                {% for artist in analytics.top_artists %}
                <div class="artist-card">
                    <img src="{{ artist.image_url }}" alt="{{ artist.name }}">
                    <h3>{{ artist.name }}</h3>
                    <p>Popularity: {{ artist.popularity }}</p>
                    <p>Genres: {{ ', '.join(artist.genres[:3]) }}</p>
                    <p>Most Played: {{ artist.most_popular_track or 'Not available' }}</p>
                    <p>Times Played: {{ artist.streams }}</p>
                </div>
                {% endfor %}
            </div>
        </section>

        <section class="listening-patterns">
            <h2>Your Listening Patterns</h2>
            <img src="data:image/png;base64,{{ analytics.listening_time_plot }}" alt="Listening Patterns Chart">
        </section>

        <section class="listening-trends">
            <h2>Your Listening Trends</h2>
            <div class="trend-cards">
                <div class="trend-card">
                    <h3>Top Genres</h3>
                    <ul>
                        {% for genre, count in analytics.listening_trends.top_genres.items() %}
                            <li>{{ genre }}: {{ count }} plays</li>
                        {% endfor %}
                    </ul>
                </div>
                <div class="trend-card">
                    <h3>Emerging Genres</h3>
                    <ul>
                        {% for genre in analytics.listening_trends.emerging_genres %}
                            <li>{{ genre }}</li>
                        {% endfor %}
                    </ul>
                </div>
                <div class="trend-card">
                    <h3>Music Mood Trends</h3>
                    <ul>
                        {% for feature, trend in analytics.listening_trends.feature_trends.items() %}
                            <li>{{ feature|capitalize }}: {{ "Increasing" if trend > 0 else "Decreasing" }}</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
            <div class="recommendations">
                <h3>Personalized Recommendations</h3>
                <ul>
                    {% for recommendation in analytics.listening_trends.recommendations %}
                        <li>{{ recommendation }}</li>
                    {% endfor %}
                </ul>
                <p>{{ analytics.listening_trends.potential_new_favorite }}</p>
            </div>
        </section>

        <section class="top-tracks">
            <h2>Your Top Tracks (Past 90 Days)</h2>
            <table>
                <thead>
                    <tr>
                        <th>Track</th>
                        <th>Artist</th>
                        <th>Album</th>
                        <th>Popularity</th>
                    </tr>
                </thead>
                <tbody>
                    {% for track in analytics.top_tracks %}
                    <tr>
                        <td>{{ track.name }}</td>
                        <td>{{ track.artist }}</td>
                        <td>{{ track.album }}</td>
                        <td>{{ track.popularity }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </section>

        <section class="recommendations">
            <h2>Recommended Tracks</h2>
            <p>Based on your top 5 tracks, we think you might like:</p>
            <table>
                <thead>
                    <tr>
                        <th>Track</th>
                        <th>Artist</th>
                        <th>Album</th>
                        <th>Popularity</th>
                    </tr>
                </thead>
                <tbody>
                    {% for track in analytics.recommended_tracks %}
                    <tr>
                        <td>{{ track.name }}</td>
                        <td>{{ track.artist }}</td>
                        <td>{{ track.album }}</td>
                        <td>{{ track.popularity }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </section>

        <section class="custom-playlist">
            <h2>Your Custom Playlist</h2>
            <p>We've created a playlist with your top 5 tracks and 5 recommended tracks.</p>
            <div class="playlist-info">
                <p><strong>Playlist Name:</strong> {{ analytics.playlist.name }}</p>
                <a href="{{ analytics.playlist.url }}" target="_blank" class="spotify-button">Open in Spotify</a>
            </div>
        </section>
    </main>

    <footer>
        <p>Data provided by Spotify. Last updated: {{ analytics.last_updated|default('N/A', true) }}</p>
    </footer>
</body>
</html>